بسم الله الرحمن الرحیم
# سند الزامات محصول (PRD): سامانه جامع مدیریت گمشدگان

**مناسبت هدف:** نیمه شعبان (قابل گسترش به اربعین و سایر تجمعات انبوه)

**نسخه:** ۱.۱

---

## ۱. هدف پروژه (Project Goal)

ایجاد یک بستر متمرکز و سریع برای ثبت و تطبیق اطلاعات افراد گمشده و پیداشده توسط خادمان و زائران، جهت تسریع در فرآیند بازگشت افراد به خانواده و ارائه گزارش‌های تحلیلی به متولیان امر (شهرداری).

---

## ۲. ذینفعان و کاربران (User Personas)

1. **زائر / موکب‌دار تایید نشده:** فردی که گزارش گم‌شدن یا پیدا شدن شخصی را ثبت می‌کند.
    
2. **موکب‌دار تایید شده:** خادم رسمی که دسترسی به پایگاه داده برای جستجو و تطبیق دارد.
    
3. **مدیریت (شهرداری):** ناظر بر تایید صلاحیت موکب‌ها و تحلیل‌گر داده‌های کلان.
    

---

## ۳. قابلیت‌های اصلی (Core Features)

### الف) ثبت گزارش (Found/Lost Registration)

- **ثبت پیدا شده:** وارد کردن نام (اگر مقدور باشد)، جنسیت، سن تقریبی، وضعیت ظاهری، **۰ تا ۵ عکس** و لوکیشن خودکار موکب.
    
- **ثبت گمشده (معکوس):** وارد کردن مشخصات فرد غایب توسط همراهان + شماره تماس مستقیم همراه.

- **فرایند آپلود عکس:** عکس‌ها به صورت جداگانه آپلود می‌شوند (presigned URL به S3) و پس از تایید، شناسه مدیا در درخواست ثبت گزارش ارسال می‌شود.
    

### ب) سیستم جستجو و تطبیق (Search & Match)

- **فیلترهای ساده‌شده:**
  - جستجوی متنی در نام و توضیحات
  - فیلتر جنسیت (اختیاری، پیش‌فرض: همه)
  - فیلتر نوع: گمشده/پیداشده (اختیاری، پیش‌فرض: همه)
  - فیلتر وضعیت: فعال/حل‌شده/معلق (پیش‌فرض فرانت: فعال، پیش‌فرض بکند: همه)
  - مرتب‌سازی: جدیدترین/نزدیک‌ترین (پیش‌فرض: جدیدترین)
    
- **تطبیق خودکار:** هنگام ثبت گزارش جدید، سیستم به صورت خودکار با گزارش‌های فعال سمت مخالف مقایسه می‌کند و کاندیداهای مچ را در پاسخ برمی‌گرداند.

- **نوتیفیکیشن مچ:** فقط به گزارش‌هایی که از قبل وجود داشتند نوتیفیکیشن ارسال می‌شود (نه به گزارش تازه ثبت‌شده).
    

### ج) سیستم اطلاع‌رسانی (Notification System)

- **نوتیفیکیشن مچ:** هنگام ایجاد مچ جدید، به صاحب گزارش قدیمی‌تر نوتیفیکیشن ارسال می‌شود.
    

---

## ۴. ماتریس سطوح دسترسی (Access Control)

|**قابلیت**|**زائر / موکب‌دار تایید نشده**|**موکب‌دار تایید شده**|**ادمین (شهرداری)**|
|---|---|---|---|
|ثبت «پیدا شده» و «گمشده»|✅|✅|✅|
|مشاهده لیست گزارش‌ها|✅ (فقط گزارش‌های خود)|✅ (همه)|✅ (همه)|
|جستجو و فیلتر|✅ (فقط گزارش‌های خود)|✅ (همه)|✅ (همه)|
|دریافت نوتیفیکیشن مچ|✅|✅|✅|
|مشاهده شماره تماس همراهان|❌|✅|✅|
|تایید صلاحیت موکب‌ها|❌|❌|✅|
|معلق کردن گزارش‌ها|❌|❌|✅|
|خروجی متابیس و گزارشات|❌|❌|✅|

---

## ۵. الزامات فنی و دیتابیس (Technical Requirements)

### ۵.۱. پنل مدیریت و گزارش‌دهی

- **Metabase Integration:** اتصال مستقیم دیتابیس به متابیس برای نمایش داشبوردهای زنده (Heatmap نقاط پرحادثه، نمودار زمانی پیک گمشدگان).
    
- **تایید هویت:** سیستم ورود بر اساس کد یک‌بار مصرف (OTP) برای تمامی کاربران.
    

### ۵.۲. زیرساخت ارتباطی

- **تماس مستقیم:** کلیک روی شماره موبایل در اپلیکیشن باید مستقیماً شماره‌گیر گوشی را باز کند (بدون چت داخلی).
    

---

## ۶. جریان کاربر (User Flow)

1. **ورود:** کاربر با شماره موبایل وارد می‌شود. اگر در لیست سفید شهرداری باشد، دسترسی «تایید شده» می‌گیرد.
    
2. **ثبت:** زائر به موکب مراجعه کرده و گزارش گمشده/پیداشده ثبت می‌شود.
    
3. **تطبیق:** موکب‌دار تایید شده در بخش جستجو، موارد مشابه را می‌بیند.
    
4. **ارتباط:** موکب‌دار با زائر (شاکی) تماس گرفته و هماهنگی برای تحویل انجام می‌شود.
    
5. **اختتام:** پس از تحویل، ثبت‌کننده وضعیت پرونده را به «حل‌شده» تغییر می‌دهد تا از لیست جستجو حذف شود.

---

## ۶.۱. وضعیت‌های سیستم

### وضعیت موکب:
- **تایید شده:** موکب توسط ادمین تایید شده است
- **تایید نشده:** موکب در انتظار تایید یا رد شده است

### وضعیت گزارش:
- **فعال:** گزارش در جستجو و مچینگ شرکت می‌کند
- **حل‌شده:** فرد پیدا شده و گزارش بسته شده است
- **معلق:** ادمین گزارش را به دلیل گذشت زمان معلق کرده است (در مچینگ شرکت نمی‌کند ولی در جستجو قابل مشاهده است)

### وضعیت مچ:
- **پیش‌فرض:** مچ ایجاد شده و منتظر اقدام است
- **تایید شده:** یکی از طرفین مچ را تایید کرده است
- **رد شده:** یکی از طرفین مچ را رد کرده است
    

---

## ۷. شاخص‌های موفقیت (KPIs)

- **میانگین زمان وصال (Time to Reclaim):** کاهش زمان بین ثبت گمشده/پیداشده تا تحویل.
    
- **نرخ تطبیق (Match Rate):** درصد افرادی که از طریق سامانه پیدا شده‌اند.
    
- **پوشش جغرافیایی:** تعداد موکب‌های تایید شده فعال در طول مسیر.
    
