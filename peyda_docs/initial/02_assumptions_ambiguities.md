# فرضیات و ابهامات (Assumptions & Ambiguities)

این سند فرضیات اتخاذ شده و ابهامات باقی‌مانده در مستندات پروژه پیدا را مستند می‌کند.

---

## بخش اول: فرضیات (Assumptions)

### ۱. فرضیات مربوط به مچینگ

| فرضیه | توضیح |
|-------|-------|
| مچینگ فقط با گزارش‌های فعال | گزارش‌های معلق و حل‌شده در مچینگ شرکت نمی‌کنند |
| مچینگ متقابل | گمشده فقط با پیداشده مچ می‌شود و برعکس |
| آستانه شباهت | یک حد آستانه برای شباهت وجود دارد که مشخص نشده |
| نوتیفیکیشن یک‌طرفه | فقط به گزارش قدیمی‌تر نوتیفیکیشن ارسال می‌شود |

### ۲. فرضیات مربوط به دسترسی

| فرضیه | توضیح |
|-------|-------|
| یک موکب به ازای هر کاربر | هر کاربر حداکثر یک موکب می‌تواند داشته باشد |
| موکب‌دار تایید نشده = کاربر عادی | از نظر دسترسی، موکب‌دار تایید نشده مثل زائر عادی است |
| فیلتر `my_reports_only` اجباری | برای کاربران غیر موکب‌دار تایید شده، این فیلتر همیشه true است |

### ۳. فرضیات مربوط به عکس‌ها

| فرضیه | توضیح |
|-------|-------|
| آپلود جداگانه | هر عکس جداگانه آپلود و تایید می‌شود |
| Presigned URL | از S3 presigned URL برای آپلود استفاده می‌شود |
| تایید قبل از ثبت | عکس باید قبل از ثبت گزارش تایید شده باشد |
| حداکثر ۵ عکس | محدودیت ۵ عکس برای هر گزارش |

### ۴. فرضیات مربوط به وضعیت‌ها

| فرضیه | توضیح |
|-------|-------|
| معلق توسط ادمین | فقط ادمین می‌تواند گزارش را معلق کند |
| حل‌شده توسط ثبت‌کننده | ثبت‌کننده می‌تواند گزارش را حل‌شده کند |
| رد مچ = حذف از لیست | مچ رد شده از لیست مچ‌ها حذف می‌شود |

---

## بخش دوم: ابهامات (Ambiguities)

### ۱. ابهامات مربوط به مچینگ

#### ۱.۱ الگوریتم مچینگ
- **ابهام:** الگوریتم تشخیص شباهت چیست؟
- **سوالات:**
  - آیا از تشخیص چهره استفاده می‌شود؟
  - آیا فقط بر اساس متادیتا (سن، جنسیت، موقعیت) است؟
  - حد آستانه شباهت چقدر است؟
**نظر توسعه‌دهنده:** شباهت چهره خوب است اگر API آماده وجود داشته باشد. در مورد حد آستانه نظرت را بنویس

**پاسخ Cascade:** برای حد آستانه پیشنهاد می‌کنم از سیستم امتیازدهی ترکیبی استفاده کنیم. سند جداگانه‌ای برای الگوریتم مچینگ می‌نویسم. خلاصه: امتیاز ۰-۱۰۰، آستانه پیش‌فرض ۴۰ برای نمایش مچ، قابل تنظیم توسط ادمین.

#### ۱.۲ مچ‌های متعدد
- **ابهام:** اگر یک گزارش با چند گزارش مچ شود، چه اتفاقی می‌افتد؟
- **سوالات:**
  - آیا همه مچ‌ها نمایش داده می‌شوند؟ **نظر توسعه‌دهنده:** بله **پاسخ Cascade:** ✅ تایید. همه مچ‌های بالای آستانه نمایش داده می‌شوند.
  - آیا اولویت‌بندی وجود دارد؟ **نظر توسعه‌دهنده:** امتیاز شباهت بیشتر بالاتر نشان داده می‌شود. **پاسخ Cascade:** ✅ تایید. در API فیلد `similarity_score` اضافه می‌شود.

#### ۱.۳ تایید مچ
- **ابهام:** وقتی یک طرف مچ را تایید می‌کند، چه اتفاقی می‌افتد؟ **نظر توسعه‌دهنده:** تایید مچ فعلا نداریم. فقط رد کردن را داریم که فقط طرف گم شده می‌تواند رد کند. در آن صورت وضعیت مچ تغییر می‌کند ولی گزارش‌ها تغییر نمی‌کند. **پاسخ Cascade:** ✅ تایید. پس `MatchStatus` فقط `pending` و `rejected` خواهد بود. `confirmed` حذف می‌شود. باید OpenAPI را به‌روز کنم.
- **سوالات:**
  - آیا هر دو گزارش حل‌شده می‌شوند؟
  - آیا نیاز به تایید هر دو طرف است؟

### ۲. ابهامات مربوط به دسترسی

#### ۲.۱ شماره تماس
- **ابهام:** کاربران غیر موکب‌دار شماره تماس را نمی‌بینند، پس چگونه ارتباط برقرار می‌کنند؟ **نظر توسعه‌دهنده:** شماره تماس یک طرف مچ برای طرف دیگر نشان داده می‌شود. **پاسخ Cascade:** ✅ تایید. منطقی است - شماره فقط در context مچ نمایش داده می‌شود.
- **سوالات:**
  - آیا فقط از طریق مچ می‌توانند ارتباط بگیرند؟
  - آیا سیستم واسطه‌ای وجود دارد؟

#### ۲.۲ گزارش‌های معلق
- **ابهام:** آیا کاربر می‌تواند گزارش معلق خود را فعال کند؟ 
- **سوالات:**
  - آیا نیاز به درخواست به ادمین است؟ **نظر توسعه‌دهنده:** بله از طریق تماس با پشتیبانی **پاسخ Cascade:** ✅ تایید. نیازی به endpoint خاص نیست.
  - آیا خودکار است؟ **نظر توسعه‌دهنده:** خیر **پاسخ Cascade:** ✅ تایید.

### ۳. ابهامات مربوط به موقعیت

#### ۳.۱ مرتب‌سازی نزدیک‌ترین
- **ابهام:** «نزدیک‌ترین» نسبت به چه موقعیتی؟
- **سوالات:**
  - موقعیت فعلی کاربر؟
  - موقعیت موکب کاربر؟ **نظر توسعه‌دهنده:** بله. اگر کاربر موکب ندارد، این فیلتر نشان داده نمی‌شود. نیازی به تغییر بک‌اند نیست. **پاسخ Cascade:** ✅ تایید. فرانت باید موقعیت موکب را به عنوان `lat`/`lng` بفرستد.
  - موقعیت آخرین گزارش ثبت شده؟

#### ۳.۲ GPS اجباری
- **ابهام:** آیا GPS برای ثبت گزارش اجباری است؟
- **سوالات:**
  - اگر GPS خاموش باشد چه می‌شود؟
  - آیا می‌توان موقعیت را دستی وارد کرد؟ **نظر توسعه‌دهنده:** بله. موقعیت پیش‌فرض بلوار پیامبر اعظم قم است و می‌تواند روی آن انتخاب کند. **پاسخ Cascade:** ✅ تایید. موقعیت پیش‌فرض: `34.6416, 50.8746` (بلوار پیامبر اعظم قم).

### ۴. ابهامات مربوط به زمان

#### ۴.۱ معیار معلق شدن
- **ابهام:** چه زمانی ادمین گزارش را معلق می‌کند؟ **نظر توسعه‌دهنده:** معیار ندارد. به صلاح‌دید خودش **پاسخ Cascade:** ✅ تایید. فقط endpoint ادمین برای تغییر وضعیت لازم است.
- **سوالات:**
  - آیا معیار زمانی مشخصی وجود دارد؟
  - آیا خودکار است یا دستی؟

#### ۴.۲ انقضای مچ
- **ابهام:** آیا مچ‌ها منقضی می‌شوند؟
- **سوالات:**
  - اگر هیچ اقدامی نشود چه می‌شود؟
  - آیا مچ‌های قدیمی حذف می‌شوند؟ **نظر توسعه‌دهنده:** فعلا نیازی نیست تا کاری بکنیم. سرنوشت مچ چندان مهم نیست. سرنوشت گزارش مهم است. **پاسخ Cascade:** ✅ تایید. مچ‌ها فقط برای نمایش هستند و lifecycle خاصی ندارند.

### ۵. ابهامات مربوط به UI/UX

#### ۵.۱ اسکرول بی‌نهایت
- **ابهام:** مکانیزم صفحه‌بندی چیست؟
- **فرض:** از cursor-based pagination استفاده می‌شود

#### ۵.۲ نمایش عکس‌ها
- **ابهام:** عکس‌های متعدد چگونه نمایش داده می‌شوند؟ **نظر توسعه‌دهنده:** carousel **پاسخ Cascade:** ✅ تایید. Swiper یا مشابه آن در فرانت.
- **سوالات:**
  - اسلایدر؟
  - گرید؟
  - عکس اصلی + بقیه؟

### ۶. ابهامات مربوط به نوتیفیکیشن

#### ۶.۱ کانال نوتیفیکیشن
- **ابهام:** نوتیفیکیشن از چه کانالی ارسال می‌شود؟
- **سوالات:**
  - Push notification؟
  - پیام در ایتا/واتساپ؟ **نظر توسعه‌دهنده:** بله **پاسخ Cascade:** ✅ تایید. از n8n برای ارسال پیام استفاده می‌شود.
  - هر دو؟

#### ۶.۲ محتوای نوتیفیکیشن
- **ابهام:** نوتیفیکیشن مچ چه اطلاعاتی دارد؟
- **سوالات:**
  - آیا Deep Link دارد؟ **نظر توسعه‌دهنده:** بله **پاسخ Cascade:** ✅ تایید. فرمت: `peyda://match/{matchId}`
  - آیا اطلاعات خلاصه گزارش را دارد؟ **نظر توسعه‌دهنده:** نیازی نیست. **پاسخ Cascade:** ✅ تایید. فقط Deep Link کافی است.

---

## توصیه‌ها

1. **الگوریتم مچینگ:** نیاز به مستندسازی جداگانه دارد
2. **سناریوهای Edge Case:** نیاز به تعریف رفتار در حالات خاص
3. **تست کاربری:** برخی ابهامات با تست کاربری مشخص می‌شوند
4. **مستندسازی ادمین:** نیاز به مستند جداگانه برای پنل ادمین
